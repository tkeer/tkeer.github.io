"use strict";(self.webpackChunkeshop=self.webpackChunkeshop||[]).push([["src_app_standalone_sso-authenticate_sso-authenticate_component_ts","src_app_core_services_auth-user_service_ts"],{7938:(f,_,t)=>{t.r(_),t.d(_,{AuthUserService:()=>a});var e=t(4412),u=t(983),E=t(980),v=t(8141),O=t(8720),c=t(2255),l=t(1626),o=t(4438),D=t(6344),M=t(9879),h=t(6042),P=t(9636);let a=(()=>{class n{constructor(s,r,U,A){this.api=s,this.localStorage=r,this.cartService=U,this.favoriteService=A,this.userSource=new e.t(void 0),this.pendingRequests={authUser:!1},this.authUser=this.userSource.asObservable()}fetchAuthUser(){if(!this.localStorage.token)return this.userSource.next(null),u.w;this.pendingRequests.authUser=!0;const s={context:(new l._y).set(c.Kq,!1).set(c.RD,!1)};return this.api.get("account",O.w.usr,s).pipe((0,E.j)(()=>this.pendingRequests.authUser=!1)).pipe((0,v.M)(r=>this.userSource.next(r)))}getAuthUser(){return void 0===this.userSource.value&&!this.pendingRequests.authUser&&this.fetchAuthUser().subscribe(),this.authUser}logoutAuthUser(){this.localStorage.token=null,typeof document<"u"&&(document.cookie="AUTH_TOKEN="),this.userSource.next(null),this.cartService.fetchCart()}setAuthToken(s){return this.localStorage.token=s,document.cookie=`AUTH_TOKEN=${s}`,this.cartService.fetchCart(),this.favoriteService.saveAllFavorites(),this.fetchAuthUser()}static#t=this.\u0275fac=function(r){return new(r||n)(o.KVO(D.G),o.KVO(M.s),o.KVO(h.m),o.KVO(P.U))};static#e=this.\u0275prov=o.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})()},878:(f,_,t)=>{t.r(_),t.d(_,{SsoAuthenticateComponent:()=>P});var e=t(4438),u=t(8720),E=t(6977),v=t(9437),O=t(8810),c=t(1482),l=t(177),o=t(6344),D=t(3767),M=t(7938),h=t(4710);let P=(()=>{class a extends c.e{constructor(i,s,r,U,A,d){super(),this.api=i,this.authService=s,this.authUserService=r,this.route=U,this.router=A,this.platformId=d}ngOnInit(){(0,l.Vy)(this.platformId)||this.authenticate()}authenticate(){this.api.post(`oauth2/authenticate?key=${this.route.snapshot.queryParams.key}`,{},u.w.au).pipe((0,E.Q)(this.destroy$),(0,v.W)(i=>(this.router.navigate(["/auth/login"]),(0,O.$)(i)))).subscribe(i=>{this.authUserService.setAuthToken(i.id_token).subscribe(),this.authService.redirectAfterLogin()})}static#t=this.\u0275fac=function(s){return new(s||a)(e.rXU(o.G),e.rXU(D.u),e.rXU(M.AuthUserService),e.rXU(h.nX),e.rXU(h.Ix),e.rXU(e.Agw))};static#e=this.\u0275cmp=e.VBU({type:a,selectors:[["app-sso-authenticate"]],standalone:!0,features:[e.Vt3,e.aNF],decls:3,vars:0,template:function(s,r){1&s&&(e.j41(0,"div")(1,"i"),e.EFF(2,"You will be redirected shortly, please wait..."),e.k0s()())},styles:["div[_ngcontent-%COMP%]{font-size:14px;margin-top:8px;margin-left:8px}"]})}return a})()}}]);