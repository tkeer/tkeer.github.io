"use strict";(self.webpackChunkeshop=self.webpackChunkeshop||[]).push([["default-src_app_core_services_cart_service_ts"],{5341:(E,p,o)=>{o.d(p,{So:()=>u,eZ:()=>h,qR:()=>n});var d=o(7056);class h{constructor(l){this.id=l.id,this.position=l.position,this.name=l.name,this.estimatedTimeDelivery=new Date(l.estimatedTimeDelivery),this.currency=l.currency,this.costType=l.costType?{name:l.costType.name,type:l.costType.type}:void 0,this.type=l.type,this.connectedIntegration=l.connectedIntegration,this.prices=(l.prices??[]).sort((r,i)=>r.startValue-i.startValue).map(r=>new _(r)),this.pickUpStores=l?.pickUpStores?.map(d.pV.adapt),this.priceInfo=l.priceInfo}}class _{constructor(l){this.startValue=l.startValue,this.endValue=l.endValue,this.priceWithVat=l.priceWithVat,this.priceWithoutVat=l.priceWithoutVat,this.vatRate=l.vatRate,this.currency=l.currency}}var u=function(a){return a.COURIER="COURIER",a.PICKUP="PICKUP",a}(u||{}),n=function(a){return a.PICKUP="PICKUP_STORE",a.COURIER="COURIER",a.LOCKER="LOCKER",a}(n||{})},6751:(E,p,o)=>{o.d(p,{_:()=>t});var d=o(7056),h=o(5341),_=o(5756),u=o(4438);let t=(()=>{class e{constructor(){this.orderKey="checkout-order",this.pageKey="checkout-page"}saveOrder(s){s={...s,products:void 0},localStorage.setItem(this.orderKey,JSON.stringify(s))}savePage(s){localStorage.setItem(this.pageKey,s.toString())}getCachedData(){const s=this.getCacheOrder();if(s)return{order:s,page:this.getCachedPage()}}removeCachedData(){localStorage.removeItem(this.orderKey),localStorage.removeItem(this.pageKey)}getCacheOrder(){const s=localStorage.getItem(this.orderKey);if(!s)return;const a=JSON.parse(s);return a.paymentMethod&&(a.paymentMethod=new _.g5(a.paymentMethod)),a.shippingMethod&&(a.shippingMethod=new h.eZ(a.shippingMethod)),a.deliveryAddress&&(a.deliveryAddress=d.pV.adapt(a.deliveryAddress)),a.buyerAddress&&(a.buyerAddress=d.pV.adapt(a.buyerAddress)),a.deliveryPickUpStore&&(a.deliveryPickUpStore=d.pV.adapt(a.deliveryPickUpStore)),a}getCachedPage(){const s=localStorage.getItem(this.pageKey);if(s)return parseInt(s)}static#e=this.\u0275fac=function(a){return new(a||e)};static#t=this.\u0275prov=u.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})()},7056:(E,p,o)=>{o.d(p,{E6:()=>h,RX:()=>_,pV:()=>d});class d{fullAddress(t=" "){return[this.addressLine1,this.city,this.region].filter(e=>!!e).join(t)}fullAddressWithCountry(t=" "){return[this.addressLine1,this.city,this.region,this.country].filter(e=>!!e).join(t)}line1AndCity(t=" "){return[this.addressLine1,this.city].filter(e=>!!e).join(t)}fullName(){return[this.firstName,this.lastName].join(" ")}static toDto(t){const e={...t,region:t.regionCode,country:t.countryCode};return delete e.id,delete e.regionCode,delete e.countryCode,delete e.defaultAddress,t.profile===h.Individual&&(delete e.companyName,delete e.companyId),t.profile===h.Company&&(delete e.firstName,delete e.lastName),e}static adapt(t){const e=new d;return e.id=t?.id,e.profile=t?.profile,e.companyName=t?.companyName,e.companyId=t?.companyId,e.firstName=t?.firstName,e.lastName=t?.lastName,e.email=t?.email,e.phoneNumber={value:t?.phoneNumber?.value,locale:t?.phoneNumber?.locale},e.country=t?.country,e.countryCode=t?.countryCode,e.region=t?.region||t?.county,e.regionCode=t?.regionCode,e.city=t?.city,e.addressLine1=t?.addressLine1||t?.street,e.addressLine2=t?.addressLine2,e.zipCode=t?.zipCode,e.defaultAddress=t?.defaultAddress,e}}var h=function(u){return u.Individual="INDIVIDUAL",u.Company="COMPANY",u}(h||{}),_=function(u){return u.DELIVERY="DELIVERY",u.BILLING="BILLING",u}(_||{})},9222:(E,p,o)=>{o.d(p,{Z:()=>h,m:()=>_});var d=o(155);class h{constructor(){this.digitalOrder=!1}static fromDto(t){const e=new h;return e.currency=t?.currency,e.totalDeliveryWithVat=t?.totalDeliveryWithVat,e.estimatedTimeDelivery=t?.estimatedTimeDelivery,e.discountCode=t?.discountCode,e.couponMessage=t?.couponMessage,e.totalCouponDiscountWithVat=t?.totalCouponDiscountWithVat,e.totalProductsWithVat=t?.totalProductsWithVat??0,e.totalProductsWithoutCouponDiscountWithVat=t?.totalProductsWithoutCouponDiscountWithVat,e.totalWithoutDiscountWithVat=t?.totalWithoutDiscountWithVat,e.totalWithVat=t?.totalWithVat,e.totalWeight=t?.totalWeight,e.numberOfProducts=t?.numberOfProducts??0,e.products=t?.products?.map(_.fromCartDto)||[],e.digitalOrder=!e.products.find(n=>n.physicalProduct),e}}class _ extends d.Yt{static fromCartDto(t){const e=new _(t);return e.id=t.id,e.name=t.name,e.randomProductId=t.randomProductId,e.quantity=t.quantity,e.stockType={id:0,name:t.stockType,type:t.stockType},e.images=[{id:0,url:t.imageUrl??t.images?.[0]?.url,type:t.mediaType}],e.price={discountRate:t.discountRate,priceWithVat:t.priceWithVat,priceWithoutVat:t.priceWithVat,priceWithoutDiscountWithVat:t.priceWithoutDiscountWithVat},e.seo={metaUrl:t.metaUrl},e.productId=t?.productId,e.productFullReview=t.productFullReview,e}}},5756:(E,p,o)=>{o.d(p,{dS:()=>t,g5:()=>d});class d{constructor(s){this.id=s.id,this.type=new h(s.type),this.extraCostType=new _(s.extraCostType),this.value=s.value,this.priceWithVat=s.priceWithVat,this.priceWithoutVat=s.priceWithoutVat,this.vatRate=s.vatRate,this.bankTransferDetail=s.bankTransferDetail?new u(s.bankTransferDetail):void 0}calculatePrice(s){this.priceWithVat=this.getCost(s)}getCost(s){if(this.extraCostType.type===e.NO_EXTRA)return 0;if(this.extraCostType.type===e.FIXED)return this.priceWithVat??0;if(this.extraCostType.type===e.PROCENTUAL){let a=(s=s??0)*(this.value??0)/100;return this.vatRate&&(a+=a*this.vatRate/100),parseFloat(a.toFixed(2))}return 0}}class h{constructor(s){this.id=s.id,this.name=s.name,this.value=s.value}}class _{constructor(s){this.id=s.id,this.type=s.type,this.name=s.name,this.description=s.description}}class u{constructor(s){this.beneficiaryName=s.beneficiaryName,this.iban=s.iban,this.swift=s.swift,this.message=s.message,this.langKey=s.langKey}}var t=function(n){return n.ONLINE="ONLINE_PAYMENT",n.COD="CASH_ON_DELIVERY",n.CcOD="CARD_ON_DELIVERY",n.BANK_TRANSFER="BANK_TRANSFER",n}(t||{}),e=function(n){return n.PROCENTUAL="PROCENTUAL",n.NO_EXTRA="NO_EXTRA",n.FIXED="FIXED",n}(e||{})},155:(E,p,o)=>{o.d(p,{Yj:()=>n,Yt:()=>d,kW:()=>_,wr:()=>s,zu:()=>t});class d{constructor(i){this.id=i.id,this.name=i.name,this.slug=i.slug,this.isFavorite=i.isFavorite,this.price=i.price,this.monthlyPrice=i.monthlyPrice,this.discount=i.discount,this.priceDiscount=i.priceDiscount,this.condition=i.condition,this.guarantee=i.guarantee,this.randomProductId=i.randomProductId,this.returnPolicy=i.returnPolicy,this.currency=i.currency,this.sku=i.sku,this.seo=i.seo,this.dimension=i.dimension,this.stockType=i.stockType,this.stock=i.stock,this.delivery=i.delivery,this.sizes=i.sizes,this.images=i.images,this.documentations=i.documentations,this.primaryCategory=i.primaryCategory,this.description=i.description,this.marketing=i.marketing,this.shortDescription=i.shortDescription,this.reviewsCount=i.reviewsCount,this.rating=i.rating,this.variationAttributes=i.variationAttributes,this.parent=i.parent,this.variations=i.variations,this.specs=i.specs,this.eshopUrl=i.eshopUrl,this.physicalProduct=i.physicalProduct}static fromDto(i){const y={...i,specs:h.formatTechnicalSpecifications(i),stockType:void 0,parent:i.parent?d.fromDto(i.parent):void 0,variations:i.variations?i.variations.map(d.fromDto):void 0};i.eshopUrl&&(y.eshopUrl=i.eshopUrl.replace(/\/$/,""));const f={...i.stockType?.stockType};let g=i.stockType?.preorder?.startDatePreorder;return g=g?new Date(g):void 0,y.stockType={...f,startDatePreorder:g,notAvailable:i.stockType?.notAvailable,visibleNotBuyable:i.stockType?.visibleNotBuyable},new d(y)}}class h{static formatTechnicalSpecifications(i){const y=[];return i.technicalSpecificationAttributes?.forEach(f=>{y?.push({label:f.attribute.name,value:f.technicalSpecificationValues.map(g=>g.attributeValue.name).join(", ")})}),i.groupsTechnicalSpecificationAttributes?.forEach(f=>{f.attributeSet.forEach(g=>{y?.push({label:g.attribute.name,value:g.technicalSpecificationValues.map(c=>c.attributeValue.name).join(", ")})})}),y}}var _=function(r){return r.U="USED",r.N="NEW",r}(_||{}),t=function(r){return r.IMAGE="IMAGE",r.IMAGE3D="IMAGE3D",r.VIDEO="VIDEO",r}(t||{}),n=function(r){return r.IN_STOCK="IN_STOCK",r.OUT_OF_STOCK="OUT_OF_STOCK",r.PREORDER="PREORDER",r.NOT_AVAILABLE="NOT_AVAILABLE",r.LIMITED_STOCK="LIMITED_STOCK",r}(n||{}),s=function(r){return r.CROSS_SELL="CROSS_SELL",r.UP_SELL="UP_SELL",r}(s||{})},6042:(E,p,o)=>{o.d(p,{m:()=>y});var d=o(467),h=o(4412),_=o(980),u=o(8141),t=o(7468),e=o(6354),n=o(9222),s=o(8720),a=o(4438),l=o(6344),r=o(9879),i=o(6751);let y=(()=>{class f{get loading$(){return this._loading}constructor(c,m,v){this.api=c,this.localStorage=m,this.checkoutService=v,this.cartSource=new h.t(void 0),this._loading=new h.t(!1),this.cartRequestPending=!1,this.cart$=this.cartSource.asObservable()}request(c,m,v){const D=this.localStorage.cartUuid?{uuid:this.localStorage.cartUuid}:{};return this._loading.next(!0),this.api.request(c,m,s.w.inv,{body:v,headers:D}).pipe((0,_.j)(()=>this._loading.next(!1)))}fetchCart(){this.localStorage.cartUuid||this.localStorage.token?(this.cartRequestPending=!0,this.request("get","cart").pipe((0,_.j)(()=>this.cartRequestPending=!1)).subscribe(c=>{c=n.Z.fromDto(c),this.cartSource.next(c)})):this.cartSource.next(n.Z.fromDto({totalWithVat:0}))}emptyCart(){this.localStorage.cartUuid=null,this.cartSource.next(n.Z.fromDto({totalWithVat:0})),this.checkoutService.removeCachedData()}addToCart(c,m){return this.request("post","cart",{id:c,quantity:m}).pipe((0,u.M)(v=>{this.localStorage.cartUuid=v.uuid??null,this.cartSource.next(n.Z.fromDto(v)),this.checkoutService.removeCachedData()}))}updateQty(c,m){return this.request("put","cart",{id:c.id,quantity:m}).pipe((0,u.M)(v=>this.cartSource.next(n.Z.fromDto(v))))}removeCouponCode(){return this.request("delete","cart/coupon").pipe((0,u.M)(c=>this.cartSource.next(n.Z.fromDto(c))))}addCouponCode(c){return this.request("post",`cart/coupon/${c}`).pipe((0,u.M)(m=>this.cartSource.next(n.Z.fromDto(m))))}getCart(){return void 0===this.cartSource.value&&!this.cartRequestPending&&this.fetchCart(),this.cart$}removeProduct(c){return this.request("delete",`cart/${c.id}`).pipe((0,u.M)(m=>{this.cartSource.next(n.Z.fromDto(m)),this.checkoutService.removeCachedData()}))}openDialog(c){return(0,d.A)(function*(){const{CartDialogContainerComponent:m}=yield Promise.all([o.e("default-node_modules_angular_animations_fesm2022_animations_mjs"),o.e("default-node_modules_angular_forms_fesm2022_forms_mjs"),o.e("default-node_modules_angular_material_fesm2022_button_mjs"),o.e("default-node_modules_rxjs_dist_esm_internal_observable_merge_js-node_modules_angular_cdk_fesm-c0063c"),o.e("default-src_app_shared_components_main-layout_main-layout_component_ts-node_modules_angular_m-0f2d1c"),o.e("default-src_app_shared_shared_module_ts"),o.e("default-node_modules_angular_cdk_fesm2022_portal_mjs"),o.e("default-node_modules_angular_cdk_fesm2022_overlay_mjs"),o.e("default-node_modules_angular_material_fesm2022_form-field_mjs"),o.e("default-node_modules_angular_material_fesm2022_dialog_mjs"),o.e("default-node_modules_angular_material_fesm2022_select_mjs"),o.e("default-src_app_shared_components_skeleton-loaders_skeleton-loader-grid_skeleton-loader-grid_-f50381"),o.e("src_app_standalone_components_cart-dialog-container_cart-dialog-container_component_ts")]).then(o.bind(o,5965));c.clear(),c.createComponent(m)?.instance.open()})()}repeatOrder(c,m){return(0,t.p)(c.products.map(v=>this.addToCart(v.productId,v.quantity??1))).pipe((0,e.T)(()=>{m&&this.openDialog(m)}))}static#e=this.\u0275fac=function(m){return new(m||f)(a.KVO(l.G),a.KVO(r.s),a.KVO(i._))};static#t=this.\u0275prov=a.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}return f})()}}]);