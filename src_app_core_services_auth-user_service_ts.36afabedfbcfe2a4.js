"use strict";(self.webpackChunkeshop=self.webpackChunkeshop||[]).push([["src_app_core_services_auth-user_service_ts"],{7938:(P,i,e)=>{e.r(i),e.d(i,{AuthUserService:()=>D});var _=e(4412),n=e(983),a=e(980),h=e(8141),u=e(8720),c=e(2255),v=e(1626),s=e(4438),E=e(6344),l=e(9879),O=e(6042),U=e(9636);let D=(()=>{class r{constructor(t,o,f,M){this.api=t,this.localStorage=o,this.cartService=f,this.favoriteService=M,this.userSource=new _.t(void 0),this.pendingRequests={authUser:!1},this.authUser=this.userSource.asObservable()}fetchAuthUser(){if(!this.localStorage.token)return this.userSource.next(null),n.w;this.pendingRequests.authUser=!0;const t={context:(new v._y).set(c.Kq,!1).set(c.RD,!1)};return this.api.get("account",u.w.usr,t).pipe((0,a.j)(()=>this.pendingRequests.authUser=!1)).pipe((0,h.M)(o=>this.userSource.next(o)))}getAuthUser(){return void 0===this.userSource.value&&!this.pendingRequests.authUser&&this.fetchAuthUser().subscribe(),this.authUser}logoutAuthUser(){this.localStorage.token=null,typeof document<"u"&&(document.cookie="AUTH_TOKEN="),this.userSource.next(null),this.cartService.fetchCart()}setAuthToken(t){return this.localStorage.token=t,document.cookie=`AUTH_TOKEN=${t}`,this.cartService.fetchCart(),this.favoriteService.saveAllFavorites(),this.fetchAuthUser()}static#e=this.\u0275fac=function(o){return new(o||r)(s.KVO(E.G),s.KVO(l.s),s.KVO(O.m),s.KVO(U.U))};static#t=this.\u0275prov=s.jDH({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()}}]);